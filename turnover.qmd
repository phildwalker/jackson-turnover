---
title: "Turnover"
format:
  html:
    fig-width: 10
    fig-height: 6
---

```{r, init}
#| echo: false
#| warning: false
#| error: false
library(tidyverse)

source(here::here("src", "_initial_settings.R"))
source(here::here("src", "monthly_employee.R"))

emp_clean <- readRDS(file = here::here("data", "employee.RDS"))
emp_dates <- readRDS(file = here::here("data", "employee_dates.RDS"))

```

# Trend of Exits 

To start our understanding of employee turnover trends we are first looking at the monthly exits trended from 2018 to now and then we have calculated the year turnover rates. 

* We see the trend of exits (as well as yearly turnover rates) saw a significant change from pre-pandemic levels during both 2022 and 2023.
* While 2025 YTD turnover higher than pre-pandemic levels, the average monthly levels have significantly decreased.

```{r, exit-trend}
#| echo: false
#| warning: false
#| error: false
#| fig-height: 4
#| fig-align: center
source(here::here("src", "trend_exits_turnover.R"))

  pw2
```


# Macro-economic Trends

We want to understand how Jackson compares to the larger economic forces in order to assess if Jackson turnover generally aligns. 

* We do see that the job openings have slowed in the Finance and Insurance industry since the start of 2024, and the quit rate was higher in 2022 and 2023 than before or after that time frame.

```{r}
#| echo: false
#| warning: false
#| error: false
#| out-width: "100%"
#| out-height: "40%"
#| fig-align: center

source(here::here("src", "jolts_data.R"))

 bls_p1 +
    scale_x_date(date_breaks = "1 year", date_labels = "%Y") + 
  scale_color_manual(values = jcolor) +
  labs(x = NULL, y= NULL, color = NULL) + 
  theme(
    panel.background = element_rect(fill = "#F8F5F5"),
    plot.background = element_rect(fill = "#F8F5F5"),
    legend.background = element_rect(fill = "#F8F5F5"),
    legend.key = element_rect(fill = "#F8F5F5", color = "darkgrey")
  )

```

# Digging into Turnovers

## Voluntary vs Involuntary

Do we see a change in the ratio of involuntary vs voluntary terminations over time?

```{r}
#| echo: false
#| warning: false
#| error: false
#| out-width: "100%"
#| out-height: "40%"
#| fig-align: center

turnover_month <- emp_dates |> 
  # head(10) |> 
  rename(start_date = Hire_Date,
        end_date = CleanEnd) |> 
  select(employee_id = ID, start_date, end_date) |> 
  create_monthly_activity() |> 
  left_join( , y= emp_clean |> select(ID), 
      by = join_by(employee_id == ID)) |> 
  group_by(month) |> 
  summarise(active_employee = n()) |> 
  ungroup() |> 
  filter(month >= as.Date("2018-01-01")) |> 
  left_join( , y= emp_dates |> 
                  left_join(., y=emp_clean |> select(ID, Term_Type), by = join_by(ID)) |> 
                  group_by(Term_Month, Term_Type) |> 
                  summarise(exits = n()) |> 
                  ungroup(), 
        by = join_by(month == Term_Month)) |> 
  mutate(exits = ifelse(is.na(exits), 0, exits)) |> 
  mutate(turnover = exits/active_employee) |> 
  ungroup()


turnover_month |> 
  filter(month < as.Date("2025-10-01")) |> 
    filter(month >= as.Date("2018-01-01")) |> 
    ggplot(aes(month, turnover, color = Term_Type))+
    geom_point()+
    geom_line()+
  scale_x_date(date_breaks = "6 month", date_labels = "%m-%Y") + 
  scale_color_manual(values = jcolor) +
  labs(title = "Count of Employees Exits By Month and Termination Type",
    x = NULL, y= NULL) + 
  theme(
    panel.background = element_rect(fill = "#F8F5F5"),
    plot.background = element_rect(fill = "#F8F5F5"),
    legend.background = element_rect(fill = "#F8F5F5"),
    legend.key = element_rect(fill = "#F8F5F5", color = "darkgrey")
  )
```



# Notes

The initial exploratory data analysis (EDA) was performed within 'src/clean_employee.R' which can be found within the source code.

I built "monthly_employee.R" as a function that could be called to get the active number of employees per month given a dataset like this HRIS sample. This would allow for a quick recreated of monthly view when we are testing future policy impacts.