---
title: "Survey Responses"
format:
  html:
    fig-width: 8
    fig-height: 6
---

This is where we will provide an analysis into the survey responses in order to determine if we see a correlation between survey responses and the ultimately the employee's decision to leave the company or not


This is a space where we'd be interested to tease out the difference's between different demographics and whether or not their responses are indicitive of different behaviors.

```{r, overall-response}
#| echo: false
#| warning: false
#| error: false
library(tidyverse)
source(here::here("src", "_initial_settings.R"))

emp_clean <- readRDS(file = here::here("data", "employee.RDS"))
surv <- readRDS(file = here::here("data", "survey_long.RDS"))

most_recnt <- 
  surv |> 
  group_by(ID, Question_Type) |> 
  filter(Year == max(Year)) |> 
  pivot_wider(names_from = Question_Type, values_from = Response) |> 
  right_join( ,y= emp_clean |> select(ID, Term_Type),
              by = join_by(ID)) |> 
  mutate(term = ifelse(is.na(Term_Type), 0, 1))



```

# Survey Responses

## Note
The Engagement Data file contains associate responses to four survey items.

* OverallSat_[Year] – Overall, I am extremely satisfied with Jackson as a place to work.
* Recommend_[Year] – I would recommend Jackson as a great place to work.
* ThinkLeave_[Year] – I rarely think about looking for a job at a different company.
* Pride_[Year] – I feel proud to work at Jackson.

Engagement survey items were rated using a 5-point rating scale:

* 5 = Strongly Agree
* 4 = Agree
* 3 = Neither Agree nor Disagree
* 2 = Disagree
* 1 = Strongly Disagree

## Total Reponses

```{r}
#| echo: false
#| warning: false
#| error: false
#| eval: false

surv |> 
  ggplot(aes(Response))+
  geom_bar(stat = "count", aes(fill = Year), position = "dodge")+
  scale_fill_manual(values = jcolor) +
  facet_wrap(Question_Type ~ .)+
  labs(title = "Count of Responses by Year for each survey group") + 
  theme(
    panel.background = element_rect(fill = "#F8F5F5"),
    plot.background = element_rect(fill = "#F8F5F5"),
    legend.background = element_rect(fill = "#F8F5F5"),
    legend.key = element_rect(fill = "#F8F5F5", color = "darkgrey")
  )

```

```{r, resonse-table}
library(flextable)

surv |> 
  group_by(Question_Type, Year) |> 
  summarise(MedianResponse = median(Response),
            AvgResponse = mean(Response)
            ) |> 
  ungroup() |> 
  pivot_longer(cols = 3:4, names_to = "SummaryStat", values_to = "Score") |> 
  mutate(Score = round(Score, digits = 1)) |> 
  pivot_wider(names_from=Question_Type, values_from = Score) |> 
  as_grouped_data(groups = c("Year")) |> 
  flextable() |> 
    bold(j = 1, i = ~ !is.na(Year), bold = TRUE, part = "body") %>%
   bold(part = "header", bold = TRUE)

```

```{r response-perc}
#| echo: false
#| warning: false
#| error: false

surv |> 
  group_by(Question_Type, Year, Response) |> 
  count() |> 
  group_by(Question_Type, Year) |> 
  mutate(PercentGroup = n/sum(n)) |> 
  ggplot(aes(x=Response, y=PercentGroup,fill = Year))+
  geom_bar(stat = "identity", position = "dodge")+
  scale_fill_manual(values = jcolor) +
  scale_y_continuous(label = scales::percent_format(), expand = c(0,0)) +
  facet_wrap(Question_Type ~ .)+
  labs(title = "Distribution of Responses by Year for each survey group",
        y = NULL) + 
  theme(
    panel.background = element_rect(fill = "#F8F5F5"),
    plot.background = element_rect(fill = "#F8F5F5"),
    legend.background = element_rect(fill = "#F8F5F5"),
    legend.key = element_rect(fill = "#F8F5F5", color = "darkgrey")
  )

```

We see a shift in responses from more negative in 2021 -> more positive in 2025

## Responses vs Turnover 

All 4 of the survey repsonses are decently correlated with terminations.

* Because the correlations are negative, we would say that in general that the lower the response (closer to strongly disagree) that the higher the likelihood of an employee exiting. 

```{r, correlation-spearman}
#| echo: false
#| warning: false
#| error: false
#| fig-cap: "Correlation of Survey Response to Termination"

# Calculate Spearman's rank correlation for each ordinal variable
# correlation is [-1,1]

# cor_s1 <- cor.test(most_recnt$term, most_recnt$OverallSat, method = "spearman")$estimate
# cor_s1

correlations <- most_recnt %>%
  rename(Surv_OverallSat = OverallSat, Surv_Recommend = Recommend, Surv_ThinkLeave = ThinkLeave, Surv_Pride = Pride) |> 
  select(starts_with("Surv_")) %>% # Select all ordinal variables
  map_df(~cor(most_recnt$term, ., method = "spearman", use = "pairwise.complete.obs"), 
         .id = "variable") %>%
  select(-ID)


correlations |> flextable::flextable()
```

