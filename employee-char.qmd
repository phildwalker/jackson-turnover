---
title: "Employee Characteristics"
format:
  html:
    fig-width: 8
    fig-height: 6
---

This is where we will provide an analysis into the HRIS data in order to determine if we see if there are certain employee charatistics make are indicitive of whether or not an employee is more likely to leave.

This is a space where we'd be interested to tease out the difference's between different demographics and whether or not their responses are indicitive of different behaviors.

```{r, char-init}
#| echo: false
#| warning: false
#| error: false
library(tidyverse)

source(here::here("src", "_initial_settings.R"))
source(here::here("src", "monthly_employee.R"))

emp_clean <- readRDS(file = here::here("data", "employee.RDS"))
emp_dates <- readRDS(file = here::here("data", "employee_dates.RDS"))
```

We are looking at the following descriptors: 

* Deomgraphics: 
  * Gender
  * Race (collapsed into -> white/non-white)
* Role Details:
  * Full Time vs Part Time
  * Department
  * Location
* Performance: 
  * Employee Performance
  * Most Recent Merit

  
In order to understand more about the drivers of the increases in 2022 and 2023, we will then dig into the different characteristics of our employees. 

# Analysis Overview

::: panel-tabset
## Exits:

What population is seeing the largest impact?

* Looking into the population of employees within 2022-2023 vs 2018-2022
* We're going to use an anova to 

```{r}
termd <- emp_dates |> 
  filter(Term_Date >= as.Date("2018-01-01")) |> 
  left_join(., y=emp_clean, by = join_by(ID))  |> 
  filter(ActiveEmp == 0) 

termd |> count(Department)
# termd |> count(Location)
# termd |> count(Job_Level)
# termd |> count(Associate_Type)
# termd |> count(Time_Type)
# termd |> count(FLSA)
# termd |> count(Race_Ethnicity)
# termd |> count(Gender)
# termd |> count(MostRecent_Performance)
# termd |> count(Term_Type)

```

## Voluntary vs Involuntary

Do we see a change in the ratio of involuntary vs voluntary terminations over time?

```{r}
#| echo: false
#| warning: false
#| error: false
#| out-width: "100%"
#| out-height: "40%"
#| fig-align: center

turnover_month <- emp_dates |> 
  # head(10) |> 
  rename(start_date = Hire_Date,
        end_date = CleanEnd) |> 
  select(employee_id = ID, start_date, end_date) |> 
  create_monthly_activity() |> 
  left_join( , y= emp_clean |> select(ID), 
      by = join_by(employee_id == ID)) |> 
  group_by(month) |> 
  summarise(active_employee = n()) |> 
  ungroup() |> 
  filter(month >= as.Date("2018-01-01")) |> 
  left_join( , y= emp_dates |> 
                  left_join(., y=emp_clean |> select(ID, Term_Type), by = join_by(ID)) |> 
                  group_by(Term_Month, Term_Type) |> 
                  summarise(exits = n()) |> 
                  ungroup(), 
        by = join_by(month == Term_Month)) |> 
  mutate(exits = ifelse(is.na(exits), 0, exits)) |> 
  mutate(turnover = exits/active_employee) |> 
  ungroup()


turnover_month |> 
  filter(month < as.Date("2025-10-01")) |> 
    filter(month >= as.Date("2018-01-01")) |> 
    ggplot(aes(month, turnover, color = Term_Type))+
    geom_point()+
    geom_line()+
  scale_x_date(date_breaks = "6 month", date_labels = "%m-%Y") + 
  scale_color_manual(values = jcolor) +
  labs(title = "Count of Employees Exits By Month and Termination Type",
    x = NULL, y= NULL) + 
  theme(
    panel.background = element_rect(fill = "#F8F5F5"),
    plot.background = element_rect(fill = "#F8F5F5"),
    legend.background = element_rect(fill = "#F8F5F5"),
    legend.key = element_rect(fill = "#F8F5F5", color = "darkgrey")
  )
```

## Turnover rate

What's the yearly turnover rates from 2018 to now

```{r}

```

## Next Steps

-   Detailing the current tur

:::